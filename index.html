<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HiraKata - Aprende Japon√©s Interactivamente</title>
    <link rel="stylesheet" href="./styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Counter.dev -->
    <script
      src="https://cdn.counter.dev/script.js"
      data-id="61260487-e25d-4200-8b59-7a9d4f76bfa3"
      data-utcoffset="2"
    ></script>
  </head>
  <body
    class="bg-gradient-to-br from-slate-50 to-blue-50 text-slate-800 font-['Inter',sans-serif] min-h-screen"
  >
    <div id="app">
      <div class="flex items-center justify-center min-h-screen">
        <div class="text-center">
          <div
            class="w-20 h-20 bg-gradient-to-br from-indigo-500 to-blue-600 rounded-full mx-auto mb-6 flex items-center justify-center animate-pulse"
          >
            <span class="text-white text-2xl font-bold">„Å≤</span>
          </div>
          <h2
            class="text-xl font-semibold text-slate-700 mb-2"
            id="loading-title"
          >
            Cargando HiraKata
          </h2>
          <p class="text-slate-500" id="loading-subtitle">
            Sistema modular en acci√≥n...
          </p>
        </div>
      </div>
    </div>
    <script src="./components/config.js"></script>
    <script src="./components/i18n.js?v=2"></script>
    <script src="./components/template-engine.js"></script>
    <script src="./components/language-selector-simple.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        try {
          await new Promise((resolve, reject) => {
            const timeout = setTimeout(() => {
              reject(new Error("Timeout esperando i18n"));
            }, 5000);

            const checkI18n = () => {
              if (
                window.i18n &&
                (window.i18n.isReady ||
                  window.i18n.isLanguageLoaded(window.i18n.currentLanguage))
              ) {
                clearTimeout(timeout);
                resolve();
              }
            };

            checkI18n();

            window.addEventListener("i18nReady", () => {
              clearTimeout(timeout);
              resolve();
            });
          });

          if (typeof window.t !== "function") {
            throw new Error("Funci√≥n de traducci√≥n t() no est√° disponible");
          }

          const loadingTitle = document.getElementById("loading-title");
          const loadingSubtitle = document.getElementById("loading-subtitle");

          if (loadingTitle) loadingTitle.textContent = t("loading.title");
          if (loadingSubtitle)
            loadingSubtitle.textContent = t("loading.subtitle");

          const templateEngine = new TemplateEngine("./");

          const [
            headerComponent,
            footerComponent,
            featuresComponent,
            ctaComponent,
            referenceTablesComponent,
            languageSelectorComponent,
          ] = await Promise.all([
            templateEngine.loadComponent("header.html"),
            templateEngine.loadComponent("footer.html"),
            templateEngine.loadComponent("features-section.html"),
            templateEngine.loadComponent("cta-section.html"),
            templateEngine.loadComponent("reference-tables.html"),
            templateEngine.loadComponent("language-selector-simple.html"),
          ]);

          const context = {
            headerGradient:
              "bg-gradient-to-r from-indigo-600 via-blue-600 to-purple-600",
            logoSize: "h-24 md:h-28",
            logoPadding: "pt-12",
            titlePadding: "pb-8",
            titleSize: "text-3xl md:text-4xl lg:text-5xl",
            titleLayout: "",
            titleIcon: "",
            pageTitle: t("home.title"),
            subtitle: t("home.subtitle"),
            textColor: "text-indigo-100",
            navSpacing: "space-x-4 md:space-x-8",

            logoPath: "./",
            cssPath: "./",
            homeUrl: "./",
            hiraganaUrl: "./hiragana/",
            katakanaUrl: "./katakana/",

            hiraganaClass: "hover:text-indigo-100",
            katakanaClass: "hover:text-indigo-100",
            hiraganaState:
              "hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/50 border-2 border-transparent hover:border-white/30",
            katakanaState:
              "hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/50 border-2 border-transparent hover:border-white/30",
      extraNavItems: `<a href="#reference-tables"
             class="group px-6 py-3 text-white hover:text-indigo-100 transition-all duration-300 text-lg font-semibold rounded-lg hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/50 border-2 border-transparent hover:border-white/30">
            <span class="flex items-center space-x-2">
              <span>üìö</span>
              <span data-i18n="navigation.practice">${t("navigation.practice")}</span>
            </span>
          </a>`,

            languageSelector: templateEngine.render(
              languageSelectorComponent,
              {}
            ),
            katakanaFeature1: "46 caracteres b√°sicos",
            katakanaFeature2: "Palabras extranjeras",
          };

          const renderedHeader = templateEngine.render(
            headerComponent,
            context
          );
          const renderedFeatures = templateEngine.render(
            featuresComponent,
            context
          );
          const renderedCTA = templateEngine.render(ctaComponent, context);
          const renderedReferenceTables = templateEngine.render(
            referenceTablesComponent,
            context
          );
          const renderedFooter = templateEngine.render(
            footerComponent,
            context
          );

          const fullPage = `
                    ${renderedHeader}
                    
                    
                    <main class="py-16 px-4">
                        ${renderedFeatures}
                        ${renderedCTA}
                        ${renderedReferenceTables}
                    </main>
                    
                    ${renderedFooter}
                `;

          document.getElementById("app").innerHTML = fullPage;

          document.documentElement.lang = window.i18n.currentLanguage;

          window.updateUI = async function () {
            try {
        const newContext = {
        ...context,
        pageTitle: t("home.title"),
        subtitle: t("home.subtitle"),
        // Regenerar extraNavItems para no quedar fijado en idioma previo
        extraNavItems: `<a href="#reference-tables"
             class="group px-6 py-3 text-white hover:text-indigo-100 transition-all duration-300 text-lg font-semibold rounded-lg hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/50 border-2 border-transparent hover:border-white/30">
            <span class="flex items-center space-x-2">
              <span>üìö</span>
              <span data-i18n="navigation.practice">${t("navigation.practice")}</span>
            </span>
          </a>`
        };

              const newRenderedHeader = templateEngine.render(
                headerComponent,
                newContext
              );
              const newRenderedFeatures = templateEngine.render(
                featuresComponent,
                newContext
              );
              const newRenderedCTA = templateEngine.render(
                ctaComponent,
                newContext
              );
              const newRenderedReferenceTables = templateEngine.render(
                referenceTablesComponent,
                newContext
              );
              const newRenderedFooter = templateEngine.render(
                footerComponent,
                newContext
              );

              const newFullPage = `
                            ${newRenderedHeader}
                            
                            
                            <main class="py-16 px-4">
                                ${newRenderedFeatures}
                                ${newRenderedCTA}
                                ${newRenderedReferenceTables}
                            </main>
                            
                            ${newRenderedFooter}
                        `;
              document.getElementById("app").innerHTML = newFullPage;

              document.documentElement.lang = window.i18n.currentLanguage;

              setTimeout(() => {
                if (window.initLanguageSelector) {
                  window.initLanguageSelector();
                }

                if (window.tryImmediateUpdate) {
                  let attempts = 0;
                  const retryUpdate = () => {
                    if (window.tryImmediateUpdate()) {
                    } else if (attempts < 10) {
                      attempts++;
                      setTimeout(retryUpdate, 50);
                    }
                  };
                  retryUpdate();
                }
              }, 50);
            } catch (error) {
              location.reload();
            }
          };
        } catch (error) {
          document.getElementById("app").innerHTML = `
                    <div class="flex items-center justify-center min-h-screen">
                        <div class="text-center text-red-600 max-w-md mx-auto p-8">
                            <div class="w-16 h-16 bg-red-100 rounded-full mx-auto mb-4 flex items-center justify-center">
                                <span class="text-red-600 text-2xl">‚ö†Ô∏è</span>
                            </div>
                            <h2 class="text-2xl font-bold mb-4">Error del Sistema Modular</h2>
                            <p class="text-slate-600 mb-4">No se pudieron cargar los componentes</p>
                            <button onclick="location.reload()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors">
                                Reintentar
                            </button>
                        </div>
                    </div>
                `;
        }
      });
    </script>
  </body>
</html>
